function loadContent(){}function loadAllMenu($scope,$http,$rootScope){$scope.promise=$http.get("api/menu/public/loadAllUserSource").success(function(response){data=response;for(getSourcePathMap(response.data,$rootScope),i=0;i<data.length;i++){var cssClass,item=data[i],url=(item.label,item.title,item.url);item.isMenu,item.isShow,item.level,item.view,item.controller;null!=item.cssClass&&(cssClass=item.cssClass);item.parentid,item.id,item.path;actionMap||(actionMap=new Map),actionMap.put(url,item)}for(var menus=[],i=0;i<data.length;i++)data[i].isMenu<0||data[i].parentId||1!=data[i].isShow||menus.push(data[i]);for(var parents=menus,childrens=[];parents.length>0;){for(var j=0;j<parents.length;j++)for(var i=0;i<data.length;i++)data[i].isMenu<0||data[i].parentId==parents[j].id&&1==data[i].isShow&&(parents[j].items?parents[j].items.push(data[i]):parents[j].items=[data[i]],childrens.push(data[i]));parents=childrens,childrens=[]}$rootScope.userMenus=menus,$rootScope.canAddFavourite=null!=actionMap.get("/favourite/add"),$rootScope.canChangePass=null!=actionMap.get("/password/changePass"),getFavouriteSource($http,$rootScope)}).error(function(data){})}function getProData($http,$rootScope){$http.get("/api/org/getProData").success(function(data){$rootScope.proDatas=data,data.length>0?$rootScope.proDatasShow=!0:$rootScope.proDatasShow=!1})}function getFavouriteSource($http,$rootScope){$http.get("/api/fwFavourite/getUserFavourite").success(function(data){for(var i=data.length-1;i>=0;i--)null!=actionMap.get(data[i].url)&&1==actionMap.get(data[i].url).isShow||data.splice(i,1);$rootScope.myFavourites=data})}function loadAllUserTenders($http,$rootScope){$http.get("/api/org/getAllUserTendsers").success(function(data){$rootScope.userTenders=data.userTenders})}function setGridHeight(){var contHeight=$(".content.n-cont").height(),tabsHeight="";$(".bs-example #headerDiv").each(function(){$(this).height()>0&&(tabsHeight=$(this).height())});var searchHeight="";$(".search-area").each(function(){$(this).height()>0&&(searchHeight=$(this).height())});var btnsHeight="";$(".results .row").each(function(){$(this).height()>0&&(btnsHeight=$(this).height())}),$(".grid").height(contHeight-(tabsHeight+btnsHeight+searchHeight+60)),$(".ztree").css({"min-height":contHeight-(tabsHeight+btnsHeight+searchHeight+60)+"px","max-height":contHeight-(tabsHeight+btnsHeight+searchHeight+60)+"px"})}var httpHeaders,message,as=angular.module("HuatekApp",["ngRoute","ngAnimate","ngResource","ngAnimate","ngCookies","ngStorage","ngMessages","ui.bootstrap","huatek.services","huatek.controllers","huatek.filters","huatek.directives","ngTouch","ui.grid","ui.grid.resizeColumns","ui.grid.selection","ui.grid.pinning","ui.grid.pagination","ui.grid.edit","ui.grid.expandable","ui.grid.grouping","ui.grid.treeView","ui.grid.cellNav","ui.grid.autoResize","ui.grid.exporter","cgBusy","oc.lazyLoad","ui.grid.validate","ui.grid.moveColumns","nya.bootstrap.select","ngDialog","mgcrea.ngStrap","blueimp.fileupload","huatek.select2","huatek.directives","selectAddress","oi.select","hljs","gettext","purplefox.numeric","multi-select-tree","ng-htmlCompiler"]),routeProviderRef;as.config(["$routeProvider","$httpProvider","$modalProvider","$asideProvider","$datepickerProvider","$controllerProvider",function($routeProvider,$httpProvider,$modalProvider,$asideProvider,$datepickerProvider,$controllerProvider){angular.extend($datepickerProvider.defaults,{placement:"bottom-left"}),angular.extend($modalProvider.defaults,{html:!0}),angular.extend($asideProvider.defaults,{container:"body",html:!0}),controllerProvider=$controllerProvider,routeProviderRef=$routeProvider,$httpProvider.interceptors.push(function($rootScope,$q){return{request:function(config){return config||$q.when(config)},response:function(response){return cnex4_isEmpty_str(response.data.text)&&submitTips(response.data.text,"success"),response||$q.when(response)},responseError:function(response){if(cnex4_isEmpty_str(response.config.url)&&"login"==response.config.url?$rootScope.setMessage({data:{text:response.data.text,type:response.data.type,show:!0}}):void 0!=response.data&&void 0!=response.data.text&&(console.warn("错误提示:%s ,异常信息: %s",response.data.text,response.data.exception),submitTips(response.data.text,"error")),401===response.status){var deferred=$q.defer();({config:response.config,deferred:deferred});return window.clearInterval($rootScope.queryMessageCountTimer),$rootScope.$broadcast("event:loginRequired"),deferred.promise}return $q.reject(response)}}}),httpHeaders=$httpProvider.defaults.headers}]).run(["$rootScope","$http","$route","$location","base64","$document","$ocLazyLoad","$timeout","cacheService","$document",function($rootScope,$http,$route,$location,base64,$document,$ocLazyLoad,$timeout,cacheService,$document){$rootScope.setMessage=function(response){response.data.text&&response.data.type&&(message={text:response.data.text,type:response.data.type,show:!0})},$rootScope.message=function(){return message},$rootScope.requests401=[];var transFn=function(data){return $.param(data)},postCfg={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:transFn};$rootScope.$on("event:loginRequired",function(){$http.post("logout",{id:1234,q:1234566},postCfg).success(function(){}),$rootScope.authenticated=!1,$location.path("/login")}),$rootScope.$on("event:logoutRequest",function(){$rootScope.authenticated=!1,delete $rootScope.name,delete httpHeaders.common.Authorization,window.location.href="./"});var routesOpenToPublic=[];angular.forEach($route.routes,function(route,path){route.publicAccess&&routesOpenToPublic.push(path)}),$rootScope.$on("$routeChangeStart",function(event,nextLoc,currentLoc){previousLoc=currentLoc;var closedToPublic=-1===routesOpenToPublic.indexOf($location.path());if(closedToPublic&&!$rootScope.authenticated)$rootScope.$broadcast("event:loginRequired");else if($rootScope.authenticated&&nextLoc&&nextLoc.originalPath){var path=nextLoc.originalPath;path.indexOf(":")>-1&&(path=path.substring(0,path.indexOf(":")-1));var sourceModule=actionMap.get(path);if(null!=sourceModule&&sourceModule.id){for(var menuIdPath=sourceModule.id,currentModel=sourceModule,count=0;count<5&&currentModel.parentid>0&&null!=(currentModel=menuMap.get(currentModel.parentid));)menuIdPath=currentModel.id+"/"+menuIdPath,count++;document.cookie="menuIds="+menuIdPath+";path=/"}}}),$rootScope.today=function(){$rootScope.dt=new Date},$rootScope.today(),$rootScope.dateOptions={formatYear:"yy",startingDay:1,showWeeks:!1,formatDayTitle:"yyyy MMMM"},$rootScope.formats=["yyyy-MM-dd","yyyy/MM/dd","dd.MM.yyyy","shortDate"],$rootScope.open=function(){$rootScope.popup.opened=!0},$rootScope.popup={opened:!1},$rootScope.getOneDayBefore=function(strDate){if(void 0!=strDate&&null!=strDate&&""!=strDate&&3==strDate.split("-").length){var today=stringToDate(strDate),yesterday_milliseconds=today.getTime()-864e5,yesterday=new Date;yesterday.setTime(yesterday_milliseconds);var strYear=yesterday.getFullYear(),strDay=yesterday.getDate(),strMonth=yesterday.getMonth()+1;return strMonth<10&&(strMonth="0"+strMonth),strYear+"-"+strMonth+"-"+strDay}return null},$rootScope.disableBtnForSecond=function($event){0==$event.target.disabled&&($event.target.disabled=!0,$timeout(function(){$event.target.disabled=!1},$rootScope.disabled_wait_time))},$rootScope.getOneDayAfter=function(strDate){if(void 0!=strDate&&null!=strDate&&""!=strDate&&3==strDate.split("-").length){var today=stringToDate(strDate),tomorrow_milliseconds=today.getTime()+864e5,tomorrow=new Date;tomorrow.setTime(tomorrow_milliseconds);var strYear=tomorrow.getFullYear(),strDay=tomorrow.getDate(),strMonth=tomorrow.getMonth()+1;return strMonth<10&&(strMonth="0"+strMonth),strYear+"-"+strMonth+"-"+strDay}return null},$rootScope.operatorItems=[{name:"等于",id:"="},{name:"大于",id:">"},{name:"小于",id:"<"},{name:"大于等于",id:">="},{name:"小于等于",id:"<="}],$rootScope.queryMessageFunction=function(){$http.get(URL_PATH.OA_HEADER+"/oaMsgInfo/count").success(function(response){void 0==$rootScope.messageCount||response>$rootScope.messageCount&&$http.get(URL_PATH.OA_HEADER+"/oaMsgInfo/lastMessage").success(function(msg){if(msg){var path=msg.linkUrl;null==path||""==path.trim()||"null"==path.trim()}}),$rootScope.messageCount=response});var session_nodo_timeout=cacheService.getData("config.session_nodo_timeout");session_nodo_timeout||(session_nodo_timeout=1800),(new Date).getTime()-$rootScope.lastActiveTime>1e3*session_nodo_timeout&&(localStorage.setItem("isAutoLogout","true"),localStorage.setItem("autoLogoutMesg","您长时间未操作，系统自动注销，请重新登录"),$scope.logout()),$http.get("api_task/session/keeper").success(function(response){"true"==response&&(localStorage.setItem("isAutoLogout","true"),localStorage.setItem("autoLogoutMesg","系统正在维护，自动注销，请稍后重新登录"),$scope.logout())})},$rootScope.lastActiveTime=(new Date).getTime(),$rootScope.onMouseMove=function(){$rootScope.lastActiveTime=(new Date).getTime()},$document.on("click",$rootScope.onMouseMove),$document.on("keydown",$rootScope.onMouseMove),$document.on("mousemove",$rootScope.onMouseMove),$document.on("mousewheel",$rootScope.onMouseMove),localStorage.getItem("isAutoLogout")&&"true"==localStorage.getItem("isAutoLogout")&&($rootScope.setMessage({data:{text:localStorage.getItem("autoLogoutMesg"),type:"danger",show:!0}}),localStorage.setItem("isAutoLogout","false")),$rootScope.getLocation=function(val,queryUrl,field,useCase,queryParam){var queryParams=null;return queryParams=void 0!=queryParam&&null!=queryParam?{name:val,queryParam:queryParam,sensor:!1}:{name:val,sensor:!1},$http.get(queryUrl,{params:queryParams}).then(function(response){return""!=response.data&&(null==field||void 0==field?response.data.map(function(item){return item.name}):(angular.forEach(response.data,function(data,index,array){data._name=data[field]}),"form"==useCase?response.data:"query"==useCase?response.data.map(function(item){return item._name}):void 0))})},$rootScope.getLocationExtend=function(val,fieldObj){fieldObj._choosed=!1;var queryParams=null,returnObj=null;return queryParams=void 0!=fieldObj.queryParam&&fieldObj.queryParam?{name:val,queryParam:fieldObj.queryParam,sensor:!1}:{name:val,sensor:!1},$http.get(fieldObj.dropDataUrl,{params:queryParams}).then(function(response){if(returnObj=response.data,""==response.data)return angular.isFunction(fieldObj.operator)&&fieldObj.operator(),"autocomplete-fill-or-select"!=fieldObj.model&&"queryParam"!=fieldObj.ObjectType&&(fieldObj.value=""),!1;var showField=null,returnField=null;null!=fieldObj.showField?(showField=fieldObj.showField,returnField=null==fieldObj.returnField?fieldObj.showField:fieldObj.returnField):(showField=fieldObj.showName,returnField="code"==fieldObj.returnValue?fieldObj.showName:fieldObj.returnValue),angular.forEach(response.data,function(data,index,array){data._returnField=data[returnField],data._showField=data[showField]})}).then(function(){return returnObj})},$rootScope.querySelectFn=function(items,query){return findOptions(query)},$rootScope.getNativeLocation=function(viewValue,queryField){var returnArr=[];return angular.forEach(queryField.itmes,function(item){trimRight(trimLeft(viewValue)).indexOf(item._returnField)>=0&&returnArr.length<=20&&returnArr.push(item)}),returnArr},$rootScope.cnex_type_of=function(obj){return typeof obj},$rootScope.cnex4_limit_quantity=20,$rootScope.autocomplete_wait_time=500,$rootScope.disabled_wait_time=3e3,$rootScope.fillDataBack=function(field){if(cnex4_isEmpty_str(field)){var itemsMap=getMap(field.items,"_returnField");field.value=itemsMap.get(field.value)}},$rootScope.chooseSelect=function(formField){formField._choosed=!0},$rootScope.checkAutoCompleteEvent=function(formField){formField._choosed||(formField.value="")},$rootScope.getSearchItems=function(val,fieldObj){var queryParams=null,returnObj=null;return queryParams={name:val},$http.post(fieldObj.dropDataUrl,queryParams).then(function(response){if(returnObj=response.data,""==response.data)return fieldObj.value="",fieldObj.displayValue="",!1}).then(function(){return returnObj})},$rootScope.onSelectQueryItem=function(paramDto,fieldObj){null!=fieldObj&&void 0!=fieldObj&&("id"==fieldObj.returnField?fieldObj.value=paramDto.id:fieldObj.value=paramDto.code,"name code"==fieldObj.showField?fieldObj.displayValue=paramDto.name+"("+paramDto.code+")":fieldObj.displayValue=paramDto.name)}}]);var getReportServerList=function($http,$rootScope){$http.get(URL_PATH.CMD_HEADER+"/reportServer/queryList").success(function(response){var serverList=[];angular.forEach(response,function(data){serverList.push(data.serverAddress+":"+data.point)}),$rootScope.reportServerList=serverList.concat(serverList)})},getSourcePathMap=function(sourcePathData,$rootScope){var map=new Map;angular.forEach(sourcePathData,function(data){map.get(data.url)||map.put(data.url,data)}),$rootScope.sourcePathMap=map},compare=function(prop){return function(obj1,obj2){var val1=obj1[prop],val2=obj2[prop];return val1<val2?-1:val1>val2?1:0}},loadUserOrg=function(http,rootScope){http.get("api/org/getCurrentAndSubOrg").success(function(res){rootScope.reportUserOrg=buildTree(res,1,"parentId","id"),rootScope.$currentOrg=res})};$("#sidebar-collapse").click(function(){$("#sidebar").hasClass("menu-min")?($(".wrap-content .n-cont").css("left","190px"),$(".menu-change-width").show()):($(".wrap-content .n-cont").css("left","40px"),$(".menu-change-width").hide())}),$(window).resize(function(){setGridHeight()}),$(".menu-change-width").draggable({axis:"x",drag:function(event,ui){return ui.offset.left>400||ui.offset.left<190?void $(".menu-change-width").draggable("destory"):($(".left-menu .sidebar").width(ui.offset.left),void $(".wrap-content .n-cont").css("left",ui.offset.left+"px"))}}),$(".sidebar .nav").css({"max-height":$(document).height()-88+"px","overflow-y":"auto"}),$(window).resize(function(){$(".sidebar .nav").css({"max-height":$(document).height()-88+"px","overflow-y":"auto"})}),$(function(){$(".dropdown-menu.comm-fearture").on("click",function(e){e.stopPropagation()})}),angular.module("huatek.controllers",[]).controller("MainController",["$q","$scope","$rootScope","$http","$location","$modal","shareData","$timeout","$ocLazyLoad","$compile","$parse","httpService","listService","$document","cacheService",function($q,$scope,$rootScope,$http,$location,$modal,shareData,$timeout,$ocLazyLoad,$compile,$parse,httpService,listService,$document,cacheService){if($rootScope.refreshToDoCount=function(){$http.get("api_workflow/myjob/toDoCount").success(function(response){$scope.toDoCount=response})},$scope.showToDo=function(){$scope.createTab({id:25252663,url:"/workflow/taskToDo",title:"未办理",controller:"WorkflowToDoController",view:"static/templates/list/template_home.html"})},$location.url()){var response=null;if(response=localStorage?localStorage.getItem($location.url().replace(/\//g,"")):getCookie($location.url().replace(/\//g,""))){if(response=JSON.parse(window.pwdString.decrypt(response)),message&&(message.show=!1),response.loginRequest)return void($rootScope.authenticated=!1);$rootScope.systemdatas=response.systemdata,$rootScope.authenticated=!0,$rootScope.name=response.showName,$rootScope.acctId=response.acctId,$rootScope.acctName=response.acctName,$rootScope.userName=response.userName,$rootScope.deptName=response.deptName,$rootScope.deptId=response.deptId,$rootScope.orgName=response.orgName,$rootScope.orgShortName=response.orgShortName,$rootScope.orgId=response.orgId,$rootScope.orgCode=response.orgCode,$rootScope.orgType=response.orgType,$rootScope.groupId=response.groupId,$rootScope.groupName=response.groupName,$rootScope.tenantId=response.tenantId,$rootScope.currProId=response.currProId,$rootScope.currProName=response.currProName,$rootScope.IDNumber=response.IDNumber,$rootScope.clientIp=response.clientIp,loadAllUserTenders($http,$rootScope),$rootScope.userCompList=response.userCompList,5==response.orgType?($rootScope.parentOrgCode1=response.parentOrgCode,$rootScope.orgCode1=response.orgCode,$("#officeCode").show()):$rootScope.parentOrgCode1=response.orgCode;var indexHead=angular.element($document[0].querySelector("#loginIndex"));indexHead.show(),loadAllMenu($scope,$http,$rootScope),getProData($http,$rootScope),loadUserOrg($http,$rootScope);var message_refresh_interval=cacheService.getData("config.message_refresh_interval");message_refresh_interval||(message_refresh_interval=10),$rootScope.queryMessageCountTimer=setInterval($rootScope.queryMessageFunction,1e3*message_refresh_interval),$rootScope.refreshToDoCount(),$rootScope.$broadcast("event:loginConfirmed")}else window.location.href="login.html"}else window.location.href="login.html";$scope.remainingSecond=0,$scope.intervalRemainingSecondCounter=null,$scope.remainingSecondCounter=function(){$scope.remainingSecond>0?$scope.remainingSecond=$scope.remainingSecond-1:($scope.canClickLongin=!1,window.clearInterval($scope.intervalRemainingSecondCounter))},$scope.activeWhen=function(value){return value?"active":""},$scope.path=function(){return $location.url()},$scope.changeTime=function(){$.post("common/baseSysdate/save",{sysDate:$scope.changeSysdate}).success(function(response){bootbox.alert(response.text)})};var transFn=function(data){return $.param(data)},postCfg={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:transFn};$scope.logout=function(){$http.post("logout",{id:1234,q:1234566},postCfg).success(function(){$rootScope.user=null,$scope.username=$scope.password=$scope.verifyCode=null,$scope.$emit("event:logoutRequest"),window.clearInterval($rootScope.queryMessageCountTimer)})},$(document).keypress(function(e){13!=e.which||$rootScope.authenticated||$scope.isLoginEnable||$scope.login()}),$scope.switchPro=function(id){$scope.promise=$http.get("/api/org/switch/"+id).success(function(response){$rootScope.currProId=response.currProId,$rootScope.currProName=response.currProName,$scope.promise=$http.get("api/org/getCurrentAndSubOrg").success(function(res){$rootScope.reportUserOrg=buildTree(res,1,"parentId","id"),$rootScope.$currentOrg=res}),$scope.promise=$http.get("/api/org/getAllUserTendsers").success(function(data){if($rootScope.userTenders=data.userTenders,$scope.tabMap.size()>1){var cloneMap=new Map;$scope.tabMap.each(function(key,value,index){"home"!=key&&cloneMap.put(key,value)}),cloneMap.each(function(key,value,index){$scope.deleteTab(value)})}})})},$scope.openFavourite=function(source,$event){$scope.createTab(source,$event)},$scope.addFavourite=function($event){var jsPanelKey=uuid(10);$ocLazyLoad.load(controllerMap.get("FwFavouriteController")+"?version="+huatek.version).then(function(){controllerProvider.register(jsPanelKey,function($scope,$controller){$controller("FwFavouriteController",{$scope:$scope})});var modal="<div   id='"+jsPanelKey+"' ng-controller='FwFavouriteController'> <div class='posi-rela' cg-busy={promise:promise,templateUrl:'static/templates/busy_template.html',message:'请稍候.....',backdrop:true,delay:300,minDuration:700,wrapperClass:'cg-busy'}>",sourceView="static/business/system/myFavourite/templates/favouriteSource.html";$http.get((sourceView?sourceView:TEMPLATE_NOT_FOUND_PATH)+"?version="+huatek.version).success(function(res){modal+=res,modal+="</div></div>";var jsPanel=$.jsPanel({id:urlToString("/"),selector:".content",headerTitle:"添加常用功能",contentSize:{width:800,height:500},theme:"dark",position:"center",content:$compile(modal)($scope),paneltype:!1,draggable:{containment:"parent"},onclosed:function(){}});$scope.jsPanel=jsPanel}).error(function(){console.log("加载模板失败,模版路径为："+source.view)})})},$scope.changePassWord=function($event){var jsPanelKey=uuid(10);$ocLazyLoad.load(controllerMap.get("ChangePasswordController")+"?version="+huatek.version).then(function(){controllerProvider.register(jsPanelKey,function($scope,$controller){$controller("ChangePasswordController",{$scope:$scope})});var modal="<div id='"+jsPanelKey+"' ng-controller='ChangePasswordController'><div class='posi-rela' cg-busy={promise:promise,templateUrl:'static/templates/busy_template.html',message:'请稍候.....',backdrop:true,delay:300,minDuration:700,wrapperClass:'cg-busy'}>",sourceView="/static/business/system/user/templates/editPassword.html";$http.get((sourceView?sourceView:TEMPLATE_NOT_FOUND_PATH)+"?version="+huatek.version).success(function(res){modal+=res,modal+="</div></div>";var jsPanel=$.jsPanel({id:urlToString("/"),selector:".content",headerTitle:"修改密码",contentSize:{width:800,height:500},theme:"dark",position:"center",content:$compile(modal)($scope),paneltype:!1,draggable:{containment:"parent"},onclosed:function(){}});$scope.jsPanel=jsPanel}).error(function(){console.log("加载模板失败,模版路径为："+source.view)})})},$scope.tabMap=new Map;var tabArr=[];$scope.tabMap.put("home",{title:"首页",mapKey:"home",active:"active",panelShow:!0,panels:[]}),tabArr.push({title:"首页",active:"active",panelShow:!0,mapKey:"home"}),$scope.createTab=function(item,$event){if($(".nav-list li a").removeClass("active"),$event&&$($event.target).addClass("active"),!item.items||item.items.length<=0)if($scope.tabMap.get(urlToString(item.url)))$scope.selectTab($scope.tabMap.get(urlToString(item.url)));else{if($scope.tabMap.size()>=10)return void submitTips("警告：当前同时打开的Tab个数超过上限（10），请关闭部分Tab页后再打开。","warning");var tab=new tabObject(item.title,item.controller,item.view,urlToString(item.url));$scope.tabMap.put(tab.mapKey,tab),createTabHeader(tab),createTabPanel(tab,item),$scope.selectTab(tab),tabArr.push(tab)}};var removeTab=function(tab){$scope.tabMap.remove(tab.mapKey);var arrIdex=0;angular.forEach(tabArr,function(value,key){if(value.mapKey==tab.mapKey)return void(arrIdex=key)}),selectTab(tabArr[arrIdex-1]),tabArr.splice(arrIdex,1)},createTabHeader=function(tab){var headerTemplate="<li id='"+tab.mapKey+"' role='presentation' class={{tabMap.get('"+tab.mapKey+"').active}} ng-click=selectTab(tabMap.get('"+tab.mapKey+"'))><a>"+tab.title+"<img style='cursor:pointer' ng-click=deleteTab(tabMap.get('"+tab.mapKey+"')) src='static/images/tab-close.png'></img></a></li>";tab.header=$compile(headerTemplate)($scope),angular.element("#headerDiv").append(tab.header)},removeTabHeader=function(tab){tab.header.remove()},createTabPanel=function(tab,item){var jsPanelKey=uuid(10);controllerMap.get(tab.controller)?$ocLazyLoad.load(controllerMap.get(tab.controller)+"?version="+huatek.version).then(function(){controllerProvider.register(jsPanelKey,function($scope,$controller){$scope.passParams=item.params,$scope.menuId=item.id,$controller(tab.controller,{$scope:$scope})});var panelTemplate="<div ng-controller='"+jsPanelKey+"' ng-show=tabMap.get('"+tab.mapKey+"').panelShow class='panel-body'><div cg-busy='{promise:promise,templateUrl:promiseObj.templateUrl,message:promiseObj.message,backdrop:promiseObj.backdrop,delay:promiseObj.delay,minDuration:promiseObj.minDuration}'>";$rootScope.menuId=item.id,$http.get(templateBasePath+tab.templateUrl+"?version="+huatek.version).success(function(response){panelTemplate+=response,panelTemplate+="</div></div>",tab.panel=$compile(panelTemplate)($scope),angular.element("#panelDiv").append(tab.panel);var newScope=$('div[ng-controller="'+jsPanelKey+'"]').scope();newScope.tab=tab}).error(function(){console.log("加载模板失败,模版路径为："+templateBasePath+tab.templateUrl);var panelTemplate="<div ng-controller='404Controller' ng-show=tabMap.get('"+tab.mapKey+"').panelShow class='panel-body'>";$http.get(TEMPLATE_NOT_FOUND_PATH).success(function(response){panelTemplate+=response,panelTemplate+="</div>",tab.panel=$compile(panelTemplate)($scope),angular.element("#panelDiv").append(tab.panel);var newScope=$('div[ng-controller="404Controller"]').scope();newScope.tab=tab,newScope.menuId=item.id})})}):console.log("该controller未配置对应的文件路径！")},removeTabPanel=function(tab){var scope=$('div[ng-controller="'+tab.mapKey+'"]').scope();scope&&scope.$destroy(),tab.panel.remove()},removeModal=function(tab){if(tab.panels.length>0){for(var i=0;i<tab.panels.length;i++)tab.panels[i].close();tab.panels=[]}};$scope.deleteTab=function(tab){removeTabHeader(tab),removeTabPanel(tab),removeModal(tab),removeTab(tab)};var selectTab=$scope.selectTab=function(tab){$scope.tabMap.each(function(k,v){if(k==tab.mapKey)v.active="active",v.panelShow=!0;else{if("active"==v.active&&v.panels.length>0)for(var i=0;i<v.panels.length;i++)v.panels[i].minimize();v.active="",v.panelShow=!1}})};$scope.showMessage=function(){$scope.createTab({id:25252101241,url:"/oaMsgInfo/home",title:"系统消息",controller:"OaMsgInfoController",view:"static/templates/list/template_home.html"})},$scope.toTrain=function(){window.open("train.html","_blank")}}]).controller("404Controller",function(){}).directive("tabHighlight",[function(){return{restrict:"A",link:function(scope,element){var x,y,initial_background="#c3d5e6";element.removeAttr("style").mousemove(function(e){element.hasClass("active")||(x=e.pageX-this.offsetLeft,y=e.pageY-this.offsetTop,element.css({background:"-moz-radial-gradient(circle at "+x+"px "+y+"px, rgba(255,255,255,0.4) 0px, rgba(255,255,255,0.0) 45px), "+initial_background}).css({background:"-webkit-radial-gradient(circle at "+x+"px "+y+"px, rgba(255,255,255,0.4) 0px, rgba(255,255,255,0.0) 45px), "+initial_background}).css({background:"radial-gradient(circle at "+x+"px "+y+"px, rgba(255,255,255,0.4) 0px, rgba(255,255,255,0.0) 45px), "+initial_background}))}).mouseout(function(){element.removeAttr("style")})}}}]).directive("draggable",["$document",function($document){return function(scope,element,attr){function mousemove(event){y=event.pageY-startY,x=event.pageX-startX,element.css({top:y+"px",left:x+"px"})}function mouseup(){$document.off("mousemove",mousemove),$document.off("mouseup",mouseup)}var startX=0,startY=0,x=0,y=0;element=angular.element(document.getElementsByClassName("modal")),element.css({position:"relative",cursor:"move"}),element.on("mousedown",function(event){event.preventDefault(),startX=event.pageX-x,startY=event.pageY-y,$document.on("mousemove",mousemove),$document.on("mouseup",mouseup)})}}]).directive("cenx4Workflow",function(){return{require:"?ngModel",restrict:"E",scope:{ngModel:"=",processInstanceId:"="},controller:"processProgressController",templateUrl:"static/business/workflow/process/templates/template_processProgress.html?t="+huatek.version,replace:!0,link:function(scope,el,attrs,ngModel){scope.canSetPerson=!1}}}),angular.module("huatek.controllers").controller("ChartMixingStationController",function($scope,httpService,$rootScope){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/mixingStation",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("chartMixingStation")),option={title:{text:"拌合站",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],label:{normal:{show:!1,position:"center"},emphasis:{show:!1,textStyle:{fontSize:"30",fontWeight:"bold"}}},labelLine:{normal:{show:!1}},data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("/busiQualityCementMixingStation/home");tab&&tab.click()})})}).controller("ChartRawMaterialController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/rawMaterial",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("chartRawMaterial")),option={title:{text:"原材料",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("busiQualityRawMaterialInspection/home");tab&&tab.click()})})}).controller("ChartLaboratoryController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/laboratory",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("chartLaboratory")),option={title:{text:"实验室",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("/busiQualityTestInspection/home");tab&&tab.click()})})}).controller("ChartPavementPressureController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/pavementPressure",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("chartPavementPressure")),option={title:{text:"路面摊压",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("/busiQualitySpreaderRollerSpreader/home");tab&&tab.click()})})}).controller("ChartTensionGroutingController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/tensionGrouting",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("chartTensionGrouting")),option={title:{text:"张拉压浆",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("/busiQualityPrestressedTensionMain/home");tab&&tab.click()})})}).controller("ChartQualityInspectionController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/qualityInspection",postQueryPage).success(function(res){
var myChart=echarts.init(document.getElementById("chartQualityInspection")),option={title:{text:"质量巡检",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("/busiQualityRoutingInspection/home");tab&&tab.click()})})}).controller("ChartConstructionInspectionController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/constructionInspection",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("chartConstructionInspection")),option={title:{text:"施工报检",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",left:"left",data:res.legendData},series:[{name:"访问来源",type:"pie",radius:"55%",center:["50%","60%"],data:[{value:res.seriesDataList[0].value,name:res.seriesDataList[0].name},{value:res.seriesDataList[1].value,name:res.seriesDataList[1].name},{value:res.seriesDataList[2].value,name:res.seriesDataList[2].name},{value:res.seriesDataList[3].value,name:res.seriesDataList[3].name}],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};myChart.setOption(option),myChart.on("click",function(param){var tab=document.getElementById("/busiQualityConsInspection/home");tab&&tab.click()})})}).controller("ChartUnitEngineeringInspectionUnqualifiedController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/unitEngineeringInspectionUnqualified",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("unitEngineeringInspectionUnqualified")),option={title:{text:"单位工程报检不合格数",x:"center"},color:["#3398DB"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:res.legendData,axisTick:{alignWithLabel:!0}}],yAxis:[{type:"value"}],series:[{name:"单位工程报检不合格数",type:"bar",barWidth:"60%",data:res.seriesDataList}]};myChart.setOption(option)})}).controller("ChartQualitySeverityController",function($scope,httpService){var postQueryPage=copyQueryPage($scope.$parent.queryPage);httpService.post($scope,"/api/report/getReportData/qualitySeverity",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("qualitySeverity")),option={title:{x:"center"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["严重（紧急）","中度（普通）","轻微（一般）"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:["拌合站","质量巡检","施工报检"]}],yAxis:[{type:"value"}],series:[{name:"严重（紧急）",type:"bar",stack:"sss",data:res.emergency},{name:"中度（普通）",type:"bar",stack:"sss",data:res.general},{name:"轻微（一般）",type:"bar",stack:"sss",data:res.slight}]};myChart.setOption(option)})}).controller("ChartQualityDistributionChart",function($scope,httpService,listService){listService.init($scope);var queryPage=new QueryPage(1,1e3,"id desc","false"),orgId=new queryParam("机构","orgId","string","=");orgId.componentType=SEARCH_COMPONENT.SELECT_TREE_SINGLE,queryPage.addParam(orgId);var timeRanges=new queryParam("时间","timeRanges","string","=","","dic.time_ranges");timeRanges.componentType=SEARCH_COMPONENT.SELECT,timeRanges.selectCallBack=function(item){this.value=item.id},queryPage.addParam(timeRanges),listService.setQueryPage($scope,queryPage);var load=function(){var postQueryPage=copyQueryPage($scope.queryPage);httpService.post($scope,"/api/report/getReportData/qualityDistributionChart",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("qualityDistributionChart"));option={title:{text:"质量分布图",x:"left"},color:["#2FC7CB","#B7A2E0","#5BB0F0","#FFB881","#DA7981"],tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["原材料","半成品","施工过程","第三方检测"]},toolbox:{show:!0,orient:"vertical",left:"right",top:"center",feature:{mark:{show:!0},dataView:{show:!0,readOnly:!1},magicType:{show:!0,type:["line","bar","stack","tiled"]},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,xAxis:[{type:"category",axisTick:{show:!1},data:res.xAxisData}],yAxis:[{type:"value"}],series:[{name:"原材料",type:"bar",data:res.seriesRawMaterial},{name:"半成品",type:"bar",data:res.seriesPartiallyPreparedProducts},{name:"施工过程",type:"bar",data:res.seriesConstructionProcess},{name:"第三方检测",type:"bar",data:res.seriesThirdParty}]},myChart.setOption(option)})};load(),$scope.search=function(){load()}}).controller("ChartQualityProblemController",function($scope,httpService,listService){listService.init($scope);var queryPage=new QueryPage(1,1e3,"id desc","false"),orgId=new queryParam("机构","orgId","string","=");orgId.componentType=SEARCH_COMPONENT.SELECT_TREE_SINGLE,queryPage.addParam(orgId);var timeRanges=new queryParam("时间","timeRanges","string","=","","dic.time_ranges");timeRanges.componentType=SEARCH_COMPONENT.SELECT,timeRanges.selectCallBack=function(item){this.value=item.id},queryPage.addParam(timeRanges),listService.setQueryPage($scope,queryPage);var load=function(){var postQueryPage=copyQueryPage($scope.queryPage);httpService.post($scope,"/api/report/getReportData/qualityProblem",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("qualityProblem")),option={title:{x:"left"},tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},legend:{data:["已解决","未解决"]},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:[{type:"category",data:res.xAxisData}],yAxis:[{type:"value"}],series:[{name:"已解决",type:"bar",stack:"sss",data:res.yijiejue},{name:"未解决",type:"bar",stack:"sss",data:res.weijiejue}]};myChart.setOption(option)})};load(),$scope.search=function(){load()}}).controller("ChartQualityTrendsController",function($scope,httpService,listService){listService.init($scope);var queryPage=new QueryPage(1,1e3,"id desc","false"),orgId=new queryParam("机构","orgId","string","=");orgId.componentType=SEARCH_COMPONENT.SELECT_TREE_SINGLE,queryPage.addParam(orgId);var timeRanges=new queryParam("时间","timeRanges","string","=","","dic.time_ranges");timeRanges.componentType=SEARCH_COMPONENT.SELECT,timeRanges.selectCallBack=function(item){this.value=item.id},queryPage.addParam(timeRanges),listService.setQueryPage($scope,queryPage);var load=function(){var postQueryPage=copyQueryPage($scope.queryPage);httpService.post($scope,"/api/report/getReportData/qualityTrends",postQueryPage).success(function(res){var myChart=echarts.init(document.getElementById("qualityTrends"));option={title:{text:"质量趋势图",left:"left"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c}"},legend:{left:"center",data:res.legendData2},xAxis:{type:"category",name:"x",splitLine:{show:!1},data:res.xAxisData},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},yAxis:{type:"log",name:"y"},series:res.seriesDataList},myChart.setOption(option)})};load(),$scope.search=function(){load()}}),angular.module("huatek.controllers").controller("EasyFormWorkflowAuditingController",function($scope,$location,$http,httpService,$routeParams,editService,$rootScope,$q,cacheService,$timeout){$scope.busiCode=$scope.passParams.busiCode,$scope.taskId=$scope.passParams.taskId,$scope.busiId=$scope.passParams.busiId,$scope.taskKey=$scope.passParams.taskKey,$scope.taskName=$scope.passParams.taskName,$scope.processInstanceId=$scope.passParams.processInstanceId,$scope.onlyView=$scope.passParams.onlyView;var loadFormConfigUrl="api_workflow/form/loadForm/"+$scope.busiCode,loadFormDataUrl="api_workflow/form/loadData/"+$scope.busiCode,saveDataUrl="api_workflow/form/saveData/"+$scope.busiCode,initParamsUrl="api_workflow/form/initParams",systemHeader=$scope.busiCode.substring(0,$scope.busiCode.indexOf("0"));httpService.get($scope,loadFormConfigUrl).success(function(formConfig){var groups=formConfig.formFieldGroupList,fields=formConfig.formFieldConfigList,columnWrapArray=[];angular.forEach(groups,function(group,index){"审批信息"!==group.name&&"审核信息"!==group.name&&columnWrapArray.push(new multipleColumn(group.id,group.name))}),columnWrapArray.push(new multipleColumn(99,"审批信息")),$scope.columnWrapArray=columnWrapArray;var dicCategoryArr=[],dicFieldArr=[],formFieldArray=[];angular.forEach(fields,function(field,index){var formField=new FormElement(field.formFieldGroupId,field.name,field.code,field.type,field.require?1:0,field.length,field.model);if("file"!=field.model&&"fileSingle"!=field.model&&"fileMultiple"!=field.model||(formField.systemHeader=systemHeader),"result"!=formField.code&&"resultMessage"!=formField.code){if(field.defaultValue&&(formField.value=field.defaultValue),field.dropType)if("url"===field.dropType)formField.dropDataUrl=field.dropImpl;else if("dic"===field.dropType&&field.dropImpl)formField.dropDataUrl="dic."+field.dropImpl;else if("map"===field.dropType&&field.dropImpl)try{var items=eval(field.dropImpl);resolveShowFieldAndReturnField(formField,items),formField.items=items}catch(e){}formField.readonly=field.readonly,formField.isShow=field.visiable,formFieldArray.push(formField)}});var result=new FormElement(99,"审核","result","boolean",1,"128","radio","resultChange");result.items=[{code:"true",name:"同意"},{code:"false",name:"驳回"}],formFieldArray.push(result);var resultMessage=new FormElement(99,"审核意见","resultMessage","string",1,"1000","textarea");formFieldArray.push(resultMessage),formFieldArray.push(new FormElement(99,"意见模版","resultMessageTemplate","string",0,"512","select")),$rootScope.formFieldArray=formFieldArray,editService.init($scope,$http),editService.setFormFields($scope,formFieldArray),dicCategoryArr.length>0?$scope.promise=httpService.get($scope,initParamsUrl+"/"+dicCategoryArr.join(",")+"/"+dicFieldArr.join(",")).success(function(params){for(var _fieldMap=editService.getFieldMap($scope),i=0;i<params.length;i++){var formField=_fieldMap.get(params[i].fieldName);formField&&(resolveShowFieldAndReturnField(formField,params[i].params),formField.items=params[i].params)}$scope.load()}):$scope.load(),$scope.resultMessage=editService.getFieldMap($scope).get("resultMessage"),$scope.resultMessageTemplate=editService.getFieldMap($scope).get("resultMessageTemplate")}),$scope.resultChange=function(value){},$scope.load=function(){$scope.busiId>0&&editService.loadData($scope,loadFormDataUrl,$scope.busiId)},$scope.submit=function(){editService.submitData($scope,saveDataUrl)}}),angular.module("huatek.controllers").controller("EasyFormWorkflowShareController",function($scope,$location,$http,httpService,$routeParams,editService,$rootScope,$q,cacheService,$timeout){$scope.busiCode=$scope.passParams.busiCode,$scope.taskId=$scope.passParams.taskId,$scope.busiId=$scope.passParams.busiId,$scope.taskKey=$scope.passParams.taskKey,$scope.taskName=$scope.passParams.taskName,$scope.processInstanceId=$scope.passParams.processInstanceId,$scope.onlyView=$scope.passParams.onlyView;var loadFormConfigUrl="api_workflow/form/loadForm/"+$scope.busiCode,loadFormDataUrl="api_workflow/form/loadData/"+$scope.busiCode,saveDataUrl="api_workflow/form/saveData/"+$scope.busiCode,initParamsUrl="api_workflow/form/initParams",systemHeader=$scope.busiCode.substring(0,$scope.busiCode.indexOf("0"));httpService.get($scope,loadFormConfigUrl).success(function(formConfig){var groups=formConfig.formFieldGroupList,fields=formConfig.formFieldConfigList,columnWrapArray=[];angular.forEach(groups,function(group,index){columnWrapArray.push(new multipleColumn(group.id,group.name))}),$scope.columnWrapArray=columnWrapArray;var dicCategoryArr=[],dicFieldArr=[],formFieldArray=[];angular.forEach(fields,function(field,index){var formField=new FormElement(field.formFieldGroupId,field.name,field.code,field.type,field.require?1:0,field.length,field.model);if("file"!=field.model&&"fileSingle"!=field.model&&"fileMultiple"!=field.model||(formField.systemHeader=systemHeader),field.defaultValue&&(formField.value=field.defaultValue),field.dropType)if("url"===field.dropType)formField.dropDataUrl=field.dropImpl;else if("dic"===field.dropType&&field.dropImpl)formField.dropDataUrl="dic."+field.dropImpl;else if("map"===field.dropType&&field.dropImpl)try{var items=eval(field.dropImpl);resolveShowFieldAndReturnField(formField,items),formField.items=items}catch(e){}formField.readonly=field.readonly,formField.isShow=field.visiable,formFieldArray.push(formField)}),editService.init($scope,$http),editService.setFormFields($scope,formFieldArray),dicCategoryArr.length>0?$scope.promise=httpService.get($scope,initParamsUrl+"/"+dicCategoryArr.join(",")+"/"+dicFieldArr.join(",")).success(function(params){for(var _fieldMap=editService.getFieldMap($scope),i=0;i<params.length;i++){var formField=_fieldMap.get(params[i].fieldName);formField&&(resolveShowFieldAndReturnField(formField,params[i].params),formField.items=params[i].params)}$scope.load()}):$scope.load()}),$scope.load=function(){$scope.busiId>0&&editService.loadData($scope,loadFormDataUrl,$scope.busiId)},$scope.submit=function(){editService.submitData($scope,saveDataUrl)}}),angular.module("huatek.controllers").controller("EasyFormWorkflowViewController",function($scope,$location,$http,$routeParams,editService,$rootScope,$q,cacheService,$timeout){$scope.busiCode=$scope.passParams.busiCode,$scope.taskId=$scope.passParams.taskId,$scope.busiId=$scope.passParams.busiId,$scope.taskKey=$scope.passParams.taskKey,$scope.taskName=$scope.passParams.taskName,$scope.processInstanceId=$scope.passParams.processInstanceId,$scope.onlyView=$scope.passParams.onlyView;var loadFormConfigUrl="api_workflow/form/loadForm/"+$scope.busiCode,loadFormDataUrl="api_workflow/form/loadData/"+$scope.busiCode,saveDataUrl="api_workflow/form/saveData/"+$scope.busiCode,initParamsUrl="api_workflow/form/initParams",systemHeader=$scope.busiCode.substring(0,$scope.busiCode.indexOf("0"));httpService.get($scope,loadFormConfigUrl).success(function(formConfig){var groups=formConfig.formFieldGroupList,fields=formConfig.formFieldConfigList,columnWrapArray=[];angular.forEach(groups,function(group,index){columnWrapArray.push(new multipleColumn(group.id,group.name))}),$scope.columnWrapArray=columnWrapArray;var dicCategoryArr=[],dicFieldArr=[],formFieldArray=[];angular.forEach(fields,function(field,index){var formField=new FormElement(field.formFieldGroupId,field.name,field.code,field.type,field.require?1:0,field.length,field.model);if("file"!=field.model&&"fileSingle"!=field.model&&"fileMultiple"!=field.model||(formField.systemHeader=systemHeader),field.defaultValue&&(formField.value=field.defaultValue),field.dropType)if("url"===field.dropType)formField.dropDataUrl=field.dropImpl;else if("dic"===field.dropType&&field.dropImpl)formField.dropDataUrl="dic."+field.dropImpl;else if("map"===field.dropType&&field.dropImpl)try{var items=eval(field.dropImpl);resolveShowFieldAndReturnField(formField,items),formField.items=items}catch(e){}formField.readonly=!0,formField.isShow=field.visiable,formFieldArray.push(formField)}),$rootScope.formFieldArray=formFieldArray,editService.init($scope,$http),editService.setFormFields($scope,formFieldArray),dicCategoryArr.length>0?$scope.promise=httpService.get($scope,initParamsUrl+"/"+dicCategoryArr.join(",")+"/"+dicFieldArr.join(",")).success(function(params){for(var _fieldMap=editService.getFieldMap($scope),i=0;i<params.length;i++){var formField=_fieldMap.get(params[i].fieldName);formField&&(resolveShowFieldAndReturnField(formField,params[i].params),formField.items=params[i].params)}$scope.load()}):$scope.load()}),$scope.load=function(){$scope.busiId>0&&editService.loadData($scope,loadFormDataUrl,$scope.busiId)},$scope.submit=function(){editService.submitData($scope,saveDataUrl)}}),angular.module("huatek.controllers").controller("EasyFormPreviewController",function($scope,$location,$http,httpService,editService,$routeParams,$rootScope,$q,cacheService,$timeout){$scope.busiCode=$scope.passParams.busiCode,$scope.taskId=$scope.passParams.taskId,$scope.busiId=$scope.passParams.busiId,$scope.taskKey=$scope.passParams.taskKey,$scope.taskName=$scope.passParams.taskName,$scope.processInstanceId=$scope.passParams.processInstanceId,$scope.onlyView=$scope.passParams.onlyView;var loadFormConfigUrl="api_workflow/form/loadForm/"+$scope.busiCode,loadFormDataUrl="api_workflow/form/loadData/"+$scope.busiCode,saveDataUrl="api_workflow/form/saveData/"+$scope.busiCode,initParamsUrl="api_workflow/form/initParams",systemHeader=$scope.busiCode.substring(0,$scope.busiCode.indexOf("0"));httpService.get($scope,loadFormConfigUrl).success(function(formConfig){var groups=formConfig.formFieldGroupList,fields=formConfig.formFieldConfigList,columnWrapArray=[];angular.forEach(groups,function(group,index){columnWrapArray.push(new multipleColumn(group.id,group.name))}),$scope.columnWrapArray=columnWrapArray;var dicCategoryArr=[],dicFieldArr=[],formFieldArray=[];angular.forEach(fields,function(field,index){var formField=new FormElement(field.formFieldGroupId,field.name,field.code,field.type,field.require?1:0,field.length,field.model);if("file"!=field.model&&"fileSingle"!=field.model&&"fileMultiple"!=field.model||(formField.systemHeader=systemHeader),field.defaultValue&&(formField.value=field.defaultValue),field.dropType)if("url"===field.dropType)formField.dropDataUrl=field.dropImpl;else if("dic"===field.dropType&&field.dropImpl)dicCategoryArr.push(field.dropImpl),dicFieldArr.push(field.code);else if("map"===field.dropType&&field.dropImpl)try{var items=eval(field.dropImpl);resolveShowFieldAndReturnField(formField,items),formField.items=items}catch(e){}formField.readonly=field.readonly,formField.isShow=field.visiable,formFieldArray.push(formField)}),$rootScope.formFieldArray=formFieldArray,editService.init($scope,$http),editService.setFormFields($scope,formFieldArray),dicCategoryArr.length>0&&($scope.promise=httpService.get($scope,initParamsUrl+"/"+dicCategoryArr.join(",")+"/"+dicFieldArr.join(",")).success(function(params){for(var _fieldMap=editService.getFieldMap($scope),i=0;i<params.length;i++){var formField=_fieldMap.get(params[i].fieldName);formField&&(resolveShowFieldAndReturnField(formField,params[i].params),formField.items=params[i].params)}}))})}),angular.module("huatek.controllers").controller("EasyFormWorkflowPrintController",function($scope,$location,$http,$routeParams,editService,$rootScope,$q,cacheService,$timeout){$scope.busiCode=$scope.passParams.busiCode,$scope.taskId=$scope.passParams.taskId,$scope.busiId=$scope.passParams.busiId,$scope.taskKey=$scope.passParams.taskKey,$scope.taskName=$scope.passParams.taskName,$scope.processInstanceId=$scope.passParams.processInstanceId,$scope.onlyView=$scope.passParams.onlyView;var loadFormConfigUrl="api_workflow/form/loadForm/"+$scope.busiCode,loadFormDataUrl="api_workflow/form/loadData/"+$scope.busiCode,saveDataUrl="api_workflow/form/saveData/"+$scope.busiCode,initParamsUrl="api_workflow/form/initParams",systemHeader=$scope.busiCode.substring(0,$scope.busiCode.indexOf("0"));httpService.get($scope,loadFormDataUrl+"/"+$scope.busiId).success(function(formData){httpService.get($scope,loadFormConfigUrl).success(function(formConfig){var groups=formConfig.formFieldGroupList,fields=formConfig.formFieldConfigList,columnWrapArray=[];angular.forEach(groups,function(group,index){"审批信息"!==group.name&&"审核信息"!==group.name&&columnWrapArray.push(new multipleColumn(group.id,group.name))});for(var i=0;i<columnWrapArray.length;i++){var group=columnWrapArray[i];group.html="<table border='1' style='width:900px;' >";for(var cellCount=0,j=0;j<fields.length;j++){var field=fields[j];if("file"!=field.model&&"fileMultiple"!=field.model&&"fileSingle"!=field.model){var value="";for(var key in formData)if(key==field.code){value=formData[key];break}if(field.visiable&&field.formFieldGroupId==group.id&&"file"!=field.type){if("dic"===field.dropType&&field.dropImpl){var items=cacheService.getData("dic."+field.dropImpl);for(var item in items)if(items[item].code==value){value=items[item].name;break}}else if("map"===field.dropType&&field.dropImpl)try{var items=eval(field.dropImpl);for(var item in items)if(items[item].code==value){value=items[item].name;break}}catch(e){}"applyLink"==field.model&&(value=value&&value.split("|").length>0?value.split("|")[0]:""),"longtext"==field.model?(cellCount%2==1&&(group.html+="<td class='celltitle' style='padding-left:10px; font-weight:bold; height:50px; width:150px;'></td><td class='cellValue' style='padding-left:10px;'></td></tr>",cellCount++),group.html+="<tr><td class='celltitle' style='padding-left:10px; font-weight:bold; height:50px; width:150px;'>"+field.name+"</td><td class='cellValue' style='padding-left:10px;' colspan='3'>"+value+"</td></tr>"):"textarea"==field.model?(cellCount%2==1&&(group.html+="<td class='celltitle' style='padding-left:10px; font-weight:bold; height:50px; width:150px;'></td><td class='cellValue' style='padding-left:10px;'></td></tr>",cellCount++),group.html+="<tr><td class='celltitle' style='padding-left:10px; font-weight:bold; height:50px; width:150px;'>"+field.name+"</td><td class='cellTextarea' style='padding-left:10px;' colspan='3'>"+value+"</td></tr>"):"editor"==field.model?(cellCount%2==1&&(group.html+="<td class='celltitle' style='padding-left:10px; font-weight:bold; height:50px; width:150px;'></td><td class='cellValue' style='padding-left:10px;'></td></tr>",cellCount++),group.html+="<tr><td class='celltitle' style='padding-left:10px; font-weight:bold; height:50px; width:150px;'>"+field.name+"</td><td class='cellEdtor' style='height:200px;' colspan='3'>"+value+"</td></tr>"):cellCount%2==0?(group.html+="<tr><td class='celltitle' style= 'font-weight:bold; height:50px; width:150px;padding-left:10px;'>"+field.name+"</td><td class='cellValue' style='padding-left:10px;'>"+value+"</td>",cellCount++):(group.html+="<td class='celltitle' style=' font-weight:bold; height:50px; width:150px;padding-left:10px;'>"+field.name+"</td><td class='cellValue' style='padding-left:10px;'>"+value+"</td></tr>",cellCount++)}}}group.html+="</table>"}httpService.get($scope,"api_workflow/myjob/dueList/"+$scope.processInstanceId).success(function(response){var group=new multipleColumn(99,"审批信息");group.html="<table border='1' style='width:900px;'>",group.html+="<tr><td class='cpTitle' style='font-weight:bold;text-align:center;' width='150px'>审批环节</td><td class='cpTitle' style='font-weight:bold;text-align:center;' width='150px'>审批人</td><td class='cpTitle' style='font-weight:bold;text-align:center;' width='150px' >审批结果</td><td class='cpTitle' style='font-weight:bold;text-align:center;' >审批意见</td></tr>";for(var i=0;i<response.length;i++){var item=response[i];group.html+="<tr height='100px'><td>"+item.name+"</td><td>"+(item.assigneeName?item.assigneeName:"")+"</td><td>"+(item.result?item.result:"")+"</td><td>"+(item.resultMessage?item.resultMessage:"")+"</td></tr>"}group.html+="</table>",columnWrapArray.push(group)}),$scope.columnWrapArray=columnWrapArray})}),$scope.print=function(){$("div#easyFormPrintArea").printArea()}}),angular.module("huatek.controllers").controller("ApproveMessageTemplateController",function($scope,$location,$http,httpService,$routeParams,$rootScope,$q,cacheService,$timeout){var resultMessage=$scope.$parent.resultMessage||$scope.$parent.fieldMap.get("resultMessage"),resultMessageTemplate=$scope.$parent.resultMessageTemplate||$scope.$parent.fieldMap.get("resultMessageTemplate");$scope.templateChange=function(value){resultMessage.value=value.split("|")[1]},$scope.removeTemplate=function(){if(resultMessageTemplate&&resultMessageTemplate.value){var templateId=resultMessageTemplate.value.split("|")[0];httpService.post($scope,"api_workflow/form/removeTemplate/"+templateId).success(function(){$scope.loadTemplate()})}else bootbox.alert("请选择要删除的模版！")},$scope.addTemplate=function(){if(!resultMessage.value||""==resultMessage.value.trim())return void bootbox.alert("审核意见为空，不能保存为模版！");var value=resultMessage.value.trim(),templateName=prompt("请输入模版名称:","新模版");return templateName&&""!=templateName.trim()?void httpService.post($scope,"api_workflow/form/addTemplate/"+$scope.$parent.busiCode,{name:templateName,content:value}).success(function(){$scope.loadTemplate()}):void bootbox.alert("模版名称不能为空！")},$scope.loadTemplate=function(){httpService.get($scope,"api_workflow/form/loadTemplate/"+$scope.$parent.busiCode).success(function(response){"object"==typeof resultMessageTemplate&&(resolveShowFieldAndReturnField(resultMessageTemplate,response),resultMessageTemplate.items=response)})},$scope.loadTemplate()}),angular.module("huatek.controllers").controller("ExcelUploadController",function($scope,$window,editService,shareData,$filter,$http){var params=shareData.params,url=shareData.url,filePath=null,fileName=null;shareData.isMutil||!1;$scope.options={url:url,autoUpload:!1,formData:params,handleResponse:function(e,data){var files=data.result&&data.result.files;files&&files[0]&&!files.error&&(filePath=files[0].filepath,fileName=files[0].name)}},editService.init($scope),$scope.commit=function(){$scope.jsPanel.close()}}),angular.module("huatek.controllers").controller("ExcelImportController",function($scope,$window,editService,shareData,$filter,$http){var params=shareData.params,url=shareData.url;$scope.options={url:url,autoUpload:!1,formData:params},editService.init($scope),$scope.commit=function(){$scope.jsPanel.close()}});